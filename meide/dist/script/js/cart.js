(function(){function a(n,m){$.ajax({url:"../php/pic.php",dataType:"json"}).done(function(o){$.each(o,function(q,r){if(n==r.sid){var p=$(".item_product:hidden").clone(true,true);p.find(".product_pic").find("img").attr("src",r.url);p.find(".product_pic").find("img").attr("sid",r.sid);p.find(".product_xinxi").find("a").html(r.title);p.find(".product_price").find(".danjia").html(r.price);p.find(".product_num").find("input").val(m);p.find(".product_guige").find("span").html(r.guige);p.find(".product_sum").find(".sum").html((r.price*m).toFixed(2));p.css("display","block");$(".cart_item").append(p);h()}})})}if(getCookie("cookiesid")&&getCookie("cookienum")){var l=getCookie("cookiesid").split(",");var c=getCookie("cookienum").split(",");$.each(l,function(m,n){a(l[m],c[m])})}e();function e(){if(getCookie("cookiesid")&&getCookie("cookienum")){$(".cart_none").hide()}else{$(".cart_none").show()}}function h(){var n=0;var m=0;$(".item_product:visible").each(function(o,p){if($(p).find(".checkedbox input").prop("checked")){n+=parseInt($(p).find(".duoshao").find("input").val());m+=parseFloat($(p).find(".product_sum").find(".sum").html())}});$(".right_choose").find("i").html(n);$(".right_sum").html("合计："+"<i>"+m.toFixed(2)+"</i>")}$(".allchecked").on("change",function(){$(".item_product:visible").find(":checkbox").prop("checked",$(this).prop("checked"));$(".allchecked").prop("checked",$(this).prop("checked"));h()});var b=$(".item_product:visible").find(":checkbox");$(".cart_item").on("change",b,function(){if($(".item_product:visible").find("input:checkbox").length==$(".item_product:visible").find("input:checked").size()){$(".allchecked").prop("checked",true)}else{$(".allchecked").prop("checked",false)}h()});$(".add").on("click",function(){var m=$(this).parents(".item_product").find(".duoshao  input").val();m++;if(m>=99){m=99}$(this).parents(".item_product").find(".duoshao input").val(m);$(this).parents(".item_product").find(".product_sum").find(".sum").html(k($(this)));h();j($(this))});$(".down").on("click",function(){var m=$(this).parents(".item_product").find(".duoshao  input").val();m--;if(m<=1){m=1}$(this).parents(".item_product").find(".duoshao  input").val(m);$(this).parents(".item_product").find(".product_sum").find(".sum").html(k($(this)));h();j($(this))});$(".duoshao input").on("input",function(){var n=/^\d+$/g;var m=parseInt($(this).val());if(n.test(m)){if(m>=99){$(this).val(99)}else{if(m<=0){$(this).val(1)}else{$(this).val(m)}}}else{$(this).val(1)}$(this).parents(".item_product").find(".product_sum").find(".sum").html(k($(this)));h();j($(this))});function k(n){var m=parseFloat(n.parents(".item_product").find(".product_price").find(".danjia").html());var o=parseInt(n.parents(".item_product").find(".product_num input").val());return(m*o).toFixed(2)}var d=[];var f=[];function i(){if(getCookie("cookiesid")&&getCookie("cookienum")){d=getCookie("cookiesid").split(",");f=getCookie("cookienum").split(",")}}function j(n){i();var m=n.parents(".item_product").find("img").attr("sid");f[$.inArray(m,d)]=n.parents(".item_product").find(".product_num input").val();addCookie("cookienum",f.toString(),7)}function g(n,o){var m=-1;$.each(o,function(p,q){if(n==q){m=p}});o.splice(m,1);f.splice(m,1);addCookie("cookiesid",o.toString(),7);addCookie("cookienum",f.toString(),7)}$(".item_product").on("click",".product_caozuo .delete",function(m){i();if(confirm("你确定要删除吗？")){$(this).first().parents(".product_lists").remove();location.reload()}g($(this).first().parents(".product_lists").find("img").attr("sid"),d);h()});$(".del span").on("click",function(){i();if(confirm("你确定要全部删除吗？")){$(".item_product:visible").each(function(){if($(this).find("input:checkbox").is(":checked")){$(this).remove();g($(this).find("img").attr("sid"),d)}});h();e()}})})();